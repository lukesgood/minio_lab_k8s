# Lab 10 핵심 개념: 백업 전략과 재해 복구 시스템

## 📚 개요

Lab 10에서는 MinIO 환경에서의 포괄적인 백업 전략과 재해 복구 시스템을 학습합니다. 실제 운영 환경에서 발생할 수 있는 다양한 데이터 손실 시나리오와 이에 대한 체계적인 대응 방법을 실습을 통해 습득합니다.

## 🎯 핵심 학습 목표

- 다양한 백업 전략의 이해와 적용
- MinIO 버전 관리 시스템 활용
- 실제 재해 시나리오 대응 능력
- 백업 자동화 시스템 구축
- 백업 무결성 검증 및 모니터링

## 🏗️ 백업 아키텍처 개요

### 전통적인 백업 vs 객체 스토리지 백업

```
전통적인 파일 시스템 백업:
┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│ Source      │───▶│ Backup      │───▶│ Archive     │
│ Files       │    │ Software    │    │ Storage     │
│ (Local)     │    │ (rsync/tar) │    │ (Tape/Disk) │
└─────────────┘    └─────────────┘    └─────────────┘

객체 스토리지 백업:
┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│ Source      │───▶│ MinIO       │───▶│ Backup      │
│ Bucket      │    │ Client      │    │ Bucket      │
│ (Primary)   │    │ (mc)        │    │ (Secondary) │
└─────────────┘    └─────────────┘    └─────────────┘
```

### MinIO 백업 생태계

```
MinIO 백업 생태계:
┌─────────────────────────────────────────────────────────────┐
│                    Production Environment                    │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐         │
│  │ Application │  │   MinIO     │  │   Users     │         │
│  │   Data      │  │  Cluster    │  │   Data      │         │
│  └─────────────┘  └─────────────┘  └─────────────┘         │
└─────────────────────────────────────────────────────────────┘
                           │
                           ▼
┌─────────────────────────────────────────────────────────────┐
│                    Backup Layer                             │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐         │
│  │   Local     │  │   Remote    │  │   Cloud     │         │
│  │  Backup     │  │   Backup    │  │   Backup    │         │
│  └─────────────┘  └─────────────┘  └─────────────┘         │
└─────────────────────────────────────────────────────────────┘
                           │
                           ▼
┌─────────────────────────────────────────────────────────────┐
│                  Archive & Compliance                       │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐         │
│  │ Long-term   │  │ Compliance  │  │ Disaster    │         │
│  │  Archive    │  │   Archive   │  │  Recovery   │         │
│  └─────────────┘  └─────────────┘  └─────────────┘         │
└─────────────────────────────────────────────────────────────┘
```

## 📋 백업 전략 분류

### 1. 백업 방법별 분류

#### A. 전체 백업 (Full Backup)
```
전체 백업 특징:
┌─────────────────────────────────────────────────────────┐
│                    Source Data                          │
│  ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐      │
│  │ F1  │ │ F2  │ │ F3  │ │ F4  │ │ F5  │ │ F6  │      │
│  └─────┘ └─────┘ └─────┘ └─────┘ └─────┘ └─────┘      │
└─────────────────────────────────────────────────────────┘
                           │ (모든 파일 복사)
                           ▼
┌─────────────────────────────────────────────────────────┐
│                   Backup Storage                        │
│  ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐      │
│  │ F1  │ │ F2  │ │ F3  │ │ F4  │ │ F5  │ │ F6  │      │
│  └─────┘ └─────┘ └─────┘ └─────┘ └─────┘ └─────┘      │
└─────────────────────────────────────────────────────────┘

장점: 완전한 데이터 복사, 빠른 복구
단점: 많은 저장 공간, 긴 백업 시간
```

#### B. 증분 백업 (Incremental Backup)
```
증분 백업 특징:
Day 1 (전체):  [F1][F2][F3][F4][F5][F6]
Day 2 (변경):  [F2*][F7] (F2 수정, F7 추가)
Day 3 (변경):  [F1*][F8] (F1 수정, F8 추가)

복구 시: Day1 + Day2 + Day3 모두 필요

장점: 적은 저장 공간, 빠른 백업
단점: 복잡한 복구 과정, 체인 의존성
```

#### C. 동기화 백업 (Mirror Backup)
```
동기화 백업 특징:
┌─────────────────┐    ┌─────────────────┐
│   Source        │    │   Backup        │
│  ┌─────┐        │    │  ┌─────┐        │
│  │ F1  │ ──────────────▶│ F1  │        │
│  └─────┘        │    │  └─────┘        │
│  ┌─────┐        │    │  ┌─────┐        │
│  │ F2* │ ──────────────▶│ F2* │ (업데이트)
│  └─────┘        │    │  └─────┘        │
│  (F3 삭제)      │    │  (F3 삭제)      │
└─────────────────┘    └─────────────────┘

장점: 실시간 동기화, 간단한 복구
단점: 삭제 시 백업도 삭제, 버전 관리 없음
```

### 2. 백업 주기별 분류

```
백업 주기 전략:
┌─────────────────────────────────────────────────────────┐
│                    시간축                               │
│ ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐      │
│ │실시간│ │ 시간│ │ 일일│ │ 주간│ │ 월간│ │ 연간│      │
│ │백업 │ │백업 │ │백업 │ │백업 │ │백업 │ │백업 │      │
│ └─────┘ └─────┘ └─────┘ └─────┘ └─────┘ └─────┘      │
│   ↑       ↑       ↑       ↑       ↑       ↑          │
│  높은    중간    일반    낮은    매우    아카이브      │
│ 빈도     빈도     빈도     빈도    낮음     용도        │
└─────────────────────────────────────────────────────────┘
```

## 🔄 MinIO 백업 명령어 비교

### mc cp vs mc mirror vs mc sync

```bash
# 1. mc cp (복사)
mc cp --recursive source/ target/backup-$(date +%Y%m%d)/
# 특징: 매번 새로운 디렉토리에 전체 복사
# 용도: 전체 백업, 스냅샷 백업

# 2. mc mirror (미러링)
mc mirror source/ target/
# 특징: 대상을 소스와 동일하게 유지 (삭제 포함)
# 용도: 실시간 동기화, 재해 복구

# 3. mc sync (동기화)
mc sync source/ target/
# 특징: 양방향 동기화 (충돌 해결 필요)
# 용도: 다중 사이트 동기화
```

### 백업 명령어 선택 가이드

```
사용 시나리오별 명령어 선택:
┌─────────────────┐    ┌─────────────────┐
│   요구사항      │    │   권장 명령어   │
├─────────────────┼────┼─────────────────┤
│ 일일 전체 백업  │ →  │    mc cp        │
├─────────────────┼────┼─────────────────┤
│ 실시간 동기화   │ →  │   mc mirror     │
├─────────────────┼────┼─────────────────┤
│ 증분 백업       │ →  │   mc mirror     │
├─────────────────┼────┼─────────────────┤
│ 다중 사이트     │ →  │   mc sync       │
├─────────────────┼────┼─────────────────┤
│ 아카이브        │ →  │    mc cp        │
└─────────────────┘    └─────────────────┘
```
## 📚 버전 관리 시스템

### MinIO 객체 버전 관리 개념

```
버전 관리 활성화 전후:
┌─────────────────────────────────────────────────────────┐
│                버전 관리 비활성화                       │
│  ┌─────────────────┐                                   │
│  │ file.txt v1     │ ──업로드──▶ [덮어쓰기]            │
│  │ file.txt v2     │ ──업로드──▶ [v1 손실]             │
│  │ file.txt v3     │ ──업로드──▶ [v2 손실]             │
│  └─────────────────┘                                   │
└─────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────┐
│                버전 관리 활성화                         │
│  ┌─────────────────┐    ┌─────────────────┐            │
│  │ file.txt v1     │───▶│ file.txt v1     │ (보존)     │
│  │ file.txt v2     │───▶│ file.txt v2     │ (보존)     │
│  │ file.txt v3     │───▶│ file.txt v3     │ (최신)     │
│  └─────────────────┘    └─────────────────┘            │
└─────────────────────────────────────────────────────────┘
```

### 버전 관리 생명주기

```
객체 버전 생명주기:
┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│   Current   │───▶│  Previous   │───▶│   Archive   │
│   Version   │    │  Versions   │    │  Versions   │
│             │    │             │    │             │
│ • 최신 버전 │    │ • 이전 버전 │    │ • 오래된    │
│ • 기본 접근 │    │ • 명시적    │    │   버전      │
│ • 빠른 응답 │    │   접근      │    │ • 압축 저장 │
└─────────────┘    └─────────────┘    └─────────────┘
       │                   │                   │
       ▼                   ▼                   ▼
┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│ 즉시 접근   │    │ 버전 ID로   │    │ 장기 보관   │
│ 가능        │    │ 접근        │    │ 정책 적용   │
└─────────────┘    └─────────────┘    └─────────────┘
```

### 버전 관리 명령어

```bash
# 버전 관리 활성화
mc version enable local/versioned-bucket

# 버전 관리 상태 확인
mc version info local/versioned-bucket

# 모든 버전 조회
mc ls --versions local/versioned-bucket/

# 특정 버전 다운로드
mc cp --version-id <version-id> local/versioned-bucket/file.txt ./

# 특정 버전 삭제
mc rm --version-id <version-id> local/versioned-bucket/file.txt
```

## 🚨 재해 복구 시나리오

### 재해 유형별 분류

```
재해 복구 매트릭스:
┌─────────────────┬─────────────┬─────────────┬─────────────┐
│   재해 유형     │    영향도   │   복구시간  │   복구방법  │
├─────────────────┼─────────────┼─────────────┼─────────────┤
│ 파일 실수 삭제  │    낮음     │   즉시      │ 버전 복구   │
├─────────────────┼─────────────┼─────────────┼─────────────┤
│ 버킷 손실       │    중간     │  몇 분      │ 백업 복구   │
├─────────────────┼─────────────┼─────────────┼─────────────┤
│ 데이터 손상     │    높음     │  몇 시간    │ 무결성 검증 │
├─────────────────┼─────────────┼─────────────┼─────────────┤
│ 전체 시스템     │   매우높음  │   몇 일     │ 전체 복구   │
│ 장애            │             │             │             │
└─────────────────┴─────────────┴─────────────┴─────────────┘
```

## 🤖 백업 자동화 시스템

### 자동화 아키텍처

```
백업 자동화 시스템 구조:
┌─────────────────────────────────────────────────────────┐
│                  스케줄러 계층                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐     │
│  │   Cron      │  │ Kubernetes  │  │   외부      │     │
│  │   Jobs      │  │  CronJob    │  │  스케줄러   │     │
│  └─────────────┘  └─────────────┘  └─────────────┘     │
└─────────────────────────────────────────────────────────┘
                           │
                           ▼
┌─────────────────────────────────────────────────────────┐
│                  백업 실행 계층                         │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐     │
│  │   일일      │  │   증분      │  │   아카이브  │     │
│  │   백업      │  │   백업      │  │   백업      │     │
│  └─────────────┘  └─────────────┘  └─────────────┘     │
└─────────────────────────────────────────────────────────┘
                           │
                           ▼
┌─────────────────────────────────────────────────────────┐
│                  검증 및 알림 계층                      │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐     │
│  │   무결성    │  │   로그      │  │   알림      │     │
│  │   검증      │  │   기록      │  │   발송      │     │
│  └─────────────┘  └─────────────┘  └─────────────┘     │
└─────────────────────────────────────────────────────────┘
```

## 📊 백업 모니터링 및 메트릭

### 핵심 모니터링 지표

```
백업 시스템 KPI:
┌─────────────────────────────────────────────────────────┐
│                    성능 지표                            │
│                                                         │
│ 1. 백업 성공률 (Success Rate)                          │
│    목표: 99.9% 이상                                    │
│                                                         │
│ 2. 백업 소요 시간 (Backup Duration)                    │
│    목표: SLA 시간 내 완료                              │
│                                                         │
│ 3. 복구 시간 목표 (RTO)                                │
│    목표: 업무 요구사항에 따라 설정                     │
│                                                         │
│ 4. 복구 지점 목표 (RPO)                                │
│    목표: 백업 주기와 연관                              │
└─────────────────────────────────────────────────────────┘
```

## 🔧 실무 구현 가이드

### 3-2-1 백업 규칙

```
3-2-1 백업 전략:
┌─────────────────────────────────────────────────────────┐
│                    3-2-1 규칙                           │
│                                                         │
│ 3개의 복사본: 원본 + 백업 2개                          │
│ ┌─────────┐  ┌─────────┐  ┌─────────┐                  │
│ │  원본   │  │ 백업 1  │  │ 백업 2  │                  │
│ │ (운영)  │  │(로컬)   │  │(원격)   │                  │
│ └─────────┘  └─────────┘  └─────────┘                  │
│                                                         │
│ 2개의 다른 미디어: 로컬 + 클라우드                     │
│ ┌─────────────────┐  ┌─────────────────┐              │
│ │   로컬 스토리지 │  │  클라우드 스토리지│              │
│ │   (빠른 복구)   │  │  (재해 대비)    │              │
│ └─────────────────┘  └─────────────────┘              │
│                                                         │
│ 1개의 오프사이트: 물리적으로 분리된 위치               │
│ ┌─────────────────────────────────────────────────────┐ │
│ │          지리적으로 분산된 백업                     │ │
│ │   서울 ←→ 부산 ←→ 해외 클라우드                    │ │
│ └─────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────┘
```

### 백업 보존 정책

```
백업 보존 정책 예시:
┌─────────────────────────────────────────────────────────┐
│                  보존 기간 정책                         │
│                                                         │
│ 일일 백업:   30일 보존                                  │
│ ┌─────┬─────┬─────┬─────┬─────┬─────┬─────┬─────┐      │
│ │ D1  │ D2  │ D3  │ ... │ D28 │ D29 │ D30 │ 삭제│      │
│ └─────┴─────┴─────┴─────┴─────┴─────┴─────┴─────┘      │
│                                                         │
│ 주간 백업:   12주 보존                                  │
│ ┌─────┬─────┬─────┬─────┬─────┬─────┬─────┬─────┐      │
│ │ W1  │ W2  │ W3  │ ... │ W10 │ W11 │ W12 │ 삭제│      │
│ └─────┴─────┴─────┴─────┴─────┴─────┴─────┴─────┘      │
│                                                         │
│ 월간 백업:   12개월 보존                                │
│ ┌─────┬─────┬─────┬─────┬─────┬─────┬─────┬─────┐      │
│ │ M1  │ M2  │ M3  │ ... │ M10 │ M11 │ M12 │ 삭제│      │
│ └─────┴─────┴─────┴─────┴─────┴─────┴─────┴─────┘      │
│                                                         │
│ 연간 백업:   7년 보존 (규정 준수)                       │
│ ┌─────┬─────┬─────┬─────┬─────┬─────┬─────┬─────┐      │
│ │ Y1  │ Y2  │ Y3  │ Y4  │ Y5  │ Y6  │ Y7  │ 삭제│      │
│ └─────┴─────┴─────┴─────┴─────┴─────┴─────┴─────┘      │
└─────────────────────────────────────────────────────────┘
```

## 🎯 실무 활용 시나리오

### 시나리오 1: 전자상거래 플랫폼

```
전자상거래 백업 요구사항:
┌─────────────────────────────────────────────────────────┐
│ 비즈니스 요구사항:                                      │
│ • RPO: 1시간 (최대 1시간 데이터 손실 허용)              │
│ • RTO: 30분 (30분 내 서비스 복구)                       │
│ • 24/7 운영 (무중단 서비스)                             │
│                                                         │
│ 백업 전략:                                              │
│ • 실시간 미러링 (주 사이트 → 백업 사이트)              │
│ • 1시간마다 증분 백업                                   │
│ • 일일 전체 백업 (새벽 시간)                            │
│ • 주간 아카이브 백업                                    │
│                                                         │
│ 데이터 분류:                                            │
│ • 중요: 주문, 결제, 고객 정보                           │
│ • 일반: 상품 이미지, 로그                               │
│ • 임시: 세션, 캐시                                      │
└─────────────────────────────────────────────────────────┘
```

### 시나리오 2: 미디어 콘텐츠 서비스

```
미디어 서비스 백업 전략:
┌─────────────────────────────────────────────────────────┐
│ 특성:                                                   │
│ • 대용량 파일 (GB~TB 단위)                              │
│ • 읽기 중심 워크로드                                    │
│ • 지역별 CDN 배포                                       │
│                                                         │
│ 백업 접근법:                                            │
│ • 원본: 고성능 스토리지                                 │
│ • 백업: 저비용 아카이브 스토리지                        │
│ • 복제: 지역별 분산 저장                                │
│                                                         │
│ 최적화 전략:                                            │
│ • 중복 제거 (Deduplication)                             │
│ • 압축 저장                                             │
│ • 계층형 스토리지                                       │
└─────────────────────────────────────────────────────────┘
```

## 📚 추가 학습 자료

### 관련 기술 및 도구
- **백업 도구**: Restic, Duplicity, BorgBackup
- **모니터링**: Prometheus, Grafana, Zabbix
- **자동화**: Ansible, Terraform, Kubernetes CronJob
- **클라우드**: AWS S3, Google Cloud Storage, Azure Blob

### 참고 표준 및 규정
- **ISO 27001**: 정보보안 관리 시스템
- **GDPR**: 개인정보보호 규정
- **SOX**: 재무 데이터 보관 규정
- **HIPAA**: 의료 정보 보호 규정

---

이 문서는 Lab 10에서 다루는 백업과 재해 복구의 핵심 개념들을 체계적으로 정리한 것입니다. 실습을 통해 이론을 실제로 구현해보면서 운영 환경에서 활용할 수 있는 실무 지식을 습득하시기 바랍니다.
